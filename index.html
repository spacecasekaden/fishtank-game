<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bubbles the Fish - Survival Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background: linear-gradient(180deg, #0a0a1a 0%, #1a1a3e 50%, #0f2847 100%);
            font-family: 'Quicksand', sans-serif;
            overflow-x: hidden;
            padding: 15px;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5), 0 0 40px rgba(0, 212, 255, 0.3);
            margin-bottom: 15px;
            font-size: 2.2rem;
            letter-spacing: 2px;
            text-align: center;
        }

        .game-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            max-width: 100%;
        }

        .tank-wrapper {
            position: relative;
        }

        .fish-tank {
            width: 650px;
            height: 480px;
            background: linear-gradient(180deg, 
                rgba(0, 180, 230, 0.25) 0%, 
                rgba(0, 120, 170, 0.45) 50%, 
                rgba(0, 90, 140, 0.65) 100%);
            border-radius: 20px 20px 25px 25px;
            border: 10px solid #3d5a7a;
            border-top: 12px solid #4a6a8a;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
            box-shadow: 
                inset 0 0 100px rgba(0, 200, 255, 0.15),
                inset 0 -50px 100px rgba(0, 100, 150, 0.2),
                0 15px 50px rgba(0, 0, 0, 0.6),
                0 0 80px rgba(0, 150, 200, 0.25);
            touch-action: none;
        }

        .water-surface {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.4) 0%,
                rgba(200, 240, 255, 0.2) 50%,
                transparent 100%);
            animation: wave 2s ease-in-out infinite;
            z-index: 20;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(2px); }
        }

        .water-level-indicator {
            position: absolute;
            right: 5px;
            top: 10px;
            bottom: 60px;
            width: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            z-index: 25;
        }

        .water-level-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, #4ecdc4, #00a8cc);
            border-radius: 4px;
            transition: height 0.5s ease;
        }

        .sand {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55px;
            background: linear-gradient(180deg, 
                #e8c99b 0%, 
                #d4a574 30%,
                #c4956a 60%, 
                #b08560 100%);
            border-radius: 0 0 15px 15px;
        }

        .sand::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.25) 15%,
                transparent 30%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 65%,
                rgba(255, 255, 255, 0.15) 80%,
                transparent 100%);
        }

        .pebble {
            position: absolute;
            bottom: 45px;
            border-radius: 50%;
            opacity: 0.6;
        }

        .plant {
            position: absolute;
            bottom: 45px;
            width: 35px;
            transform-origin: bottom center;
        }

        .plant-1 { left: 50px; }
        .plant-2 { left: 160px; height: 110px; }
        .plant-3 { right: 90px; }
        .plant-4 { right: 200px; }

        .plant svg {
            width: 100%;
            height: auto;
            animation: sway 3s ease-in-out infinite;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
        }

        .plant-2 svg { animation-delay: -0.5s; animation-duration: 3.5s; }
        .plant-3 svg { animation-delay: -1s; animation-duration: 2.8s; }
        .plant-4 svg { animation-delay: -1.5s; animation-duration: 3.2s; }

        @keyframes sway {
            0%, 100% { transform: rotate(-4deg); }
            50% { transform: rotate(4deg); }
        }

        .rock {
            position: absolute;
            bottom: 40px;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.4));
        }

        .rock-1 {
            left: 110px;
            width: 65px;
            height: 40px;
            background: linear-gradient(145deg, #8899aa 0%, #5a6b7c 40%, #3d4852 100%);
            border-radius: 60% 50% 50% 45%;
        }

        .rock-1::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 15px;
            width: 20px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
        }

        .rock-2 {
            right: 130px;
            width: 50px;
            height: 32px;
            background: linear-gradient(145deg, #7788a0 0%, #4a5a6a 40%, #2d3a47 100%);
            border-radius: 45% 60% 45% 55%;
        }

        .castle {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 100px;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
        }

        .castle-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 55px;
            height: 55px;
            background: linear-gradient(145deg, #d4a84b 0%, #b8860b 30%, #8b6914 70%, #705a12 100%);
            border-radius: 5px;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3);
        }

        .castle-body::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 8px;
            width: 8px;
            height: 8px;
            background: #1a1a2e;
            border-radius: 2px;
            box-shadow: 30px 0 0 #1a1a2e;
        }

        .castle-door {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 28px;
            background: linear-gradient(180deg, #0a0a15 0%, #1a1a2e 100%);
            border-radius: 50% 50% 0 0;
        }

        .castle-tower {
            position: absolute;
            bottom: 50px;
            width: 22px;
            height: 55px;
            background: linear-gradient(145deg, #d4a84b 0%, #b8860b 50%, #8b6914 100%);
            border-radius: 3px;
            box-shadow: inset -3px -3px 10px rgba(0,0,0,0.3);
        }

        .castle-tower::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-bottom: 18px solid #705a12;
        }

        .castle-tower::after {
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 10px;
            background: #8b6914;
        }

        .castle-tower.left { left: 5px; }
        .castle-tower.right { right: 5px; }

        /* Fish styling */
        .fish {
            position: absolute;
            width: 75px;
            height: 55px;
            transition: transform 0.15s ease;
            z-index: 10;
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.35));
        }

        .fish.flip {
            transform: scaleX(-1);
        }

        .fish.dead {
            transform: rotate(180deg) !important;
            filter: grayscale(0.7) brightness(0.8) drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
        }

        .fish.eating .fish-mouth {
            animation: chomp 0.15s ease-in-out 4;
        }

        .fish.overfed {
            transform: scale(1.3);
            filter: hue-rotate(20deg) drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
        }

        .fish.escaped {
            animation: flop 0.3s ease-in-out infinite;
            filter: brightness(0.7) drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
        }

        @keyframes flop {
            0%, 100% { transform: rotate(-10deg) scaleY(1); }
            50% { transform: rotate(10deg) scaleY(0.9); }
        }

        @keyframes chomp {
            0%, 100% { transform: scale(1, 1); }
            50% { transform: scale(1.8, 0.3); }
        }

        /* Cleaner animals */
        .snail {
            position: absolute;
            width: 30px;
            height: 25px;
            z-index: 8;
            transition: transform 0.1s ease;
        }

        .snail.flip {
            transform: scaleX(-1);
        }

        .pleco {
            position: absolute;
            width: 50px;
            height: 25px;
            z-index: 8;
            transition: transform 0.1s ease;
        }

        .pleco.flip {
            transform: scaleX(-1);
        }

        .shrimp {
            position: absolute;
            width: 25px;
            height: 15px;
            z-index: 8;
        }

        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(200, 240, 255, 0.5) 40%, 
                rgba(150, 220, 255, 0.2) 100%);
            border-radius: 50%;
            animation: rise 4s ease-in forwards;
            pointer-events: none;
            box-shadow: inset -2px -2px 4px rgba(0,100,150,0.2);
        }

        @keyframes rise {
            0% { opacity: 0.9; }
            100% { 
                transform: translateY(-400px);
                opacity: 0;
            }
        }

        .food {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle at 30% 30%, #ffcc66 0%, #ff9933 50%, #e67300 100%);
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.35), inset -1px -1px 3px rgba(0,0,0,0.2);
        }

        .food.sinking {
            animation: sink 4s ease-in forwards;
        }

        @keyframes sink {
            0% { opacity: 1; }
            100% { 
                transform: translateY(380px);
                opacity: 0.6;
            }
        }

        /* Cleaning animation */
        .cleaning-brush {
            position: absolute;
            width: 60px;
            height: 120px;
            z-index: 50;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cleaning-brush.active {
            opacity: 1;
            animation: scrub 0.5s ease-in-out infinite;
        }

        @keyframes scrub {
            0%, 100% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
        }

        .clean-sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            animation: sparkle 0.6s ease-out forwards;
        }

        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(180deg); opacity: 0; }
        }

        /* Decorations */
        .decoration {
            position: absolute;
            z-index: 3;
            filter: drop-shadow(2px 3px 5px rgba(0,0,0,0.3));
        }

        .decoration-slots {
            position: absolute;
            bottom: 55px;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            justify-content: space-around;
            padding: 0 60px;
            pointer-events: none;
            z-index: 2;
        }

        .deco-slot {
            width: 50px;
            height: 50px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .deco-slot:hover {
            border-color: rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.05);
        }

        .deco-slot.filled {
            border: none;
            cursor: default;
        }

        .coral {
            bottom: 45px;
        }

        /* Fish customization styles */
        .fish-preview {
            width: 120px;
            height: 90px;
            margin: 15px auto;
            position: relative;
        }

        .color-options, .pattern-options, .accessory-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .color-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .color-option:hover, .color-option.selected {
            border-color: white;
            transform: scale(1.15);
        }

        .pattern-option, .accessory-option {
            padding: 8px 12px;
            background: linear-gradient(145deg, #2d5a87 0%, #1e3a5f 100%);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: white;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .pattern-option:hover, .pattern-option.selected,
        .accessory-option:hover, .accessory-option.selected {
            border-color: #4ecdc4;
        }

        .pattern-option.locked, .accessory-option.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Premium tank styles */
        .premium-section {
            background: linear-gradient(145deg, #4a3f0a 0%, #2a2505 100%);
            border: 2px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .premium-title {
            color: #ffd700;
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .premium-desc {
            color: #ccc;
            font-size: 0.8rem;
            margin-bottom: 12px;
        }

        .btn-premium {
            background: linear-gradient(145deg, #ffd700 0%, #ff8c00 100%);
            color: #000;
            font-weight: bold;
            padding: 12px 25px;
        }

        .fish-count {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            padding: 5px 15px;
            border-radius: 15px;
            color: #4ecdc4;
            font-size: 0.85rem;
            z-index: 25;
        }

        /* Big tank styles */
        .fish-tank.big-tank {
            width: 850px;
            height: 550px;
        }

        @media (max-width: 900px) {
            .fish-tank.big-tank {
                width: calc(100vw - 20px);
                max-width: 850px;
                height: calc((100vw - 20px) * 0.65);
                max-height: 550px;
            }
        }

        .fish-accessory {
            position: absolute;
            font-size: 18px;
            z-index: 11;
            pointer-events: none;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
        }

        .treasure {
            position: absolute;
            bottom: 50px;
            right: 45px;
            width: 40px;
            height: 30px;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));
        }

        .treasure-box {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #ffd700 0%, #daa520 30%, #b8860b 70%, #8b6914 100%);
            border-radius: 4px 4px 6px 6px;
            position: relative;
            box-shadow: inset -3px -3px 8px rgba(0,0,0,0.3);
        }

        .treasure-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 4px;
            right: 4px;
            height: 12px;
            background: linear-gradient(145deg, #ffd700 0%, #daa520 50%, #b8860b 100%);
            border-radius: 4px 4px 0 0;
        }

        .treasure-box::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #654321;
            border-radius: 2px;
        }

        /* Dirty overlay */
        .dirty-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(80, 100, 60, 0);
            pointer-events: none;
            transition: background 1s ease;
            border-radius: 10px;
        }

        /* Escaped fish area */
        .outside-tank {
            position: absolute;
            top: -60px;
            left: 0;
            right: 0;
            height: 60px;
            pointer-events: none;
        }

        /* Warning indicators */
        .warning-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            animation: pulse 0.5s ease-in-out infinite;
            z-index: 30;
            display: none;
        }

        .warning-icon.show {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Stats panel */
        .stats-panel {
            background: linear-gradient(145deg, #1e3a5f 0%, #0d2137 100%);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #2d5a87;
            min-width: 220px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .coin-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            background: linear-gradient(145deg, #4a3f0a 0%, #2a2505 100%);
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #8b7500;
        }

        .coin-icon {
            font-size: 1.8rem;
            animation: coinSpin 3s linear infinite;
        }

        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .coin-value {
            font-family: 'Fredoka One', cursive;
            font-size: 1.6rem;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .stat {
            margin-bottom: 15px;
        }

        .stat:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: #7ec8e3;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-icon {
            font-size: 1.1rem;
        }

        .stat-bar {
            height: 18px;
            background: #0a1628;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #2d5a87;
        }

        .stat-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease, background 0.3s ease;
            position: relative;
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 5px;
            right: 5px;
            height: 5px;
            background: linear-gradient(180deg, rgba(255,255,255,0.35) 0%, transparent 100%);
            border-radius: 3px;
        }

        .hunger-fill {
            background: linear-gradient(90deg, #ff6b6b, #ee5a5a);
        }

        .happiness-fill {
            background: linear-gradient(90deg, #ffd93d, #f9c80e);
        }

        .health-fill {
            background: linear-gradient(90deg, #6bcb77, #4ade80);
        }

        .cleanliness-fill {
            background: linear-gradient(90deg, #4ecdc4, #45b7aa);
        }

        .water-fill {
            background: linear-gradient(90deg, #00b4d8, #0077b6);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-feed {
            background: linear-gradient(145deg, #ff9966 0%, #ff6633 100%);
            color: white;
        }

        .btn-clean {
            background: linear-gradient(145deg, #4ecdc4 0%, #45b7aa 100%);
            color: white;
        }

        .btn-play {
            background: linear-gradient(145deg, #ffd93d 0%, #f9c80e 100%);
            color: #333;
        }

        .btn-water {
            background: linear-gradient(145deg, #00b4d8 0%, #0077b6 100%);
            color: white;
        }

        .btn-shop {
            background: linear-gradient(145deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .score-display {
            text-align: center;
            padding: 12px;
            background: linear-gradient(145deg, #2d5a87 0%, #1e3a5f 100%);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .score-label {
            color: #7ec8e3;
            font-size: 0.75rem;
            margin-bottom: 4px;
        }

        .score-value {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .fish-name {
            text-align: center;
            margin-bottom: 12px;
        }

        .fish-name span {
            font-family: 'Fredoka One', cursive;
            font-size: 1.4rem;
            color: #ffb347;
            text-shadow: 0 0 10px rgba(255, 179, 71, 0.5);
        }

        /* Shop Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .shop-modal {
            background: linear-gradient(145deg, #1e3a5f 0%, #0d2137 100%);
            border-radius: 20px;
            border: 3px solid #2d5a87;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .shop-modal {
            transform: scale(1);
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shop-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .close-btn {
            background: #ff6b6b;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-btn:hover {
            transform: scale(1.1);
        }

        .shop-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            color: #4ecdc4;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #2d5a87;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .shop-item {
            background: linear-gradient(145deg, #2d5a87 0%, #1e3a5f 100%);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .shop-item:hover:not(.owned):not(.disabled) {
            border-color: #4ecdc4;
            transform: translateY(-3px);
        }

        .shop-item.owned {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .shop-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .item-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .item-name {
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .item-price {
            color: #ffd700;
            font-family: 'Fredoka One', cursive;
            font-size: 0.9rem;
        }

        .item-owned {
            color: #4ade80;
            font-size: 0.8rem;
        }

        /* Game Over Screen */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .game-over.show {
            opacity: 1;
            pointer-events: auto;
        }

        .game-over h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            color: #ff6b6b;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .death-reason {
            color: #ffaa00;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .game-over p {
            color: #7ec8e3;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .btn-restart {
            background: linear-gradient(145deg, #6bcb77 0%, #4ade80 100%);
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
        }

        .instructions {
            color: #5a8ab0;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 15px;
            max-width: 700px;
            line-height: 1.4;
        }

        /* Responsive styles */
        @media (max-width: 950px) {
            .game-container {
                flex-direction: column;
                align-items: center;
            }
            
            .stats-panel {
                width: 100%;
                max-width: 650px;
            }
            
            .controls {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .controls .btn {
                flex: 1;
                min-width: 100px;
            }
        }

        @media (max-width: 680px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .fish-tank {
                width: calc(100vw - 20px);
                max-width: 650px;
                height: calc((100vw - 20px) * 0.74);
                max-height: 480px;
                border-width: 6px;
            }
            
            .sand { height: 40px; }
            
            .plant {
                width: 22px;
                bottom: 32px;
            }
            
            .plant-1 { left: 8%; }
            .plant-2 { left: 25%; }
            .plant-3 { right: 14%; }
            .plant-4 { right: 32%; }
            
            .rock { bottom: 28px; }
            .rock-1 { left: 16%; width: 50px; height: 30px; }
            .rock-2 { right: 20%; width: 40px; height: 24px; }
            
            .castle {
                width: 65px;
                height: 75px;
                bottom: 32px;
            }
            
            .castle-body { width: 42px; height: 42px; }
            .castle-door { width: 14px; height: 22px; }
            .castle-tower { width: 17px; height: 42px; bottom: 38px; }
            
            .treasure {
                width: 32px;
                height: 24px;
                bottom: 36px;
                right: 7%;
            }
            
            .fish { width: 55px; height: 42px; }
            .snail { width: 22px; height: 18px; }
            .pleco { width: 38px; height: 18px; }
            
            .stats-panel { padding: 15px; }
            .controls .btn { padding: 10px 12px; font-size: 0.75rem; }
        }

        @media (max-width: 420px) {
            h1 { font-size: 1.2rem; }
            .fish-tank { border-width: 5px; }
            .fish { width: 45px; height: 35px; }
            .castle { width: 50px; height: 60px; }
            .controls .btn { padding: 8px 10px; font-size: 0.7rem; min-width: 80px; }
        }

        /* Mobile cheat code input */
        .mobile-code-input {
            margin-top: 15px;
            display: flex;
            justify-content: center;
        }

        .mobile-code-input input {
            background: linear-gradient(145deg, #1e3a5f 0%, #0d2137 100%);
            border: 2px solid #2d5a87;
            border-radius: 20px;
            padding: 10px 18px;
            color: #7ec8e3;
            font-family: 'Quicksand', sans-serif;
            font-size: 0.9rem;
            width: 200px;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .mobile-code-input input::placeholder {
            color: #5a8ab0;
        }

        .mobile-code-input input:focus {
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }

        .mobile-code-input input.success {
            border-color: #ffd700;
            background: linear-gradient(145deg, #4a3f0a 0%, #2a2505 100%);
            color: #ffd700;
            animation: glowPulse 0.5s ease-in-out;
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        @keyframes fishFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(300px) rotate(360deg); opacity: 0; }
        }

        /* Extra fish styles */
        .extra-fish {
            position: absolute;
            width: 55px;
            height: 42px;
            z-index: 9;
            transition: transform 0.15s ease;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .extra-fish.flip {
            transform: scaleX(-1);
        }
    </style>
</head>
<body>
    <h1>üê† Bubbles' Fishtank üê†</h1>
    
    <div class="game-container">
        <div class="tank-wrapper">
            <div class="outside-tank" id="outsideTank"></div>
            <div class="fish-tank" id="tank">
                <div class="water-surface" id="waterSurface"></div>
                <div class="dirty-overlay" id="dirtyOverlay"></div>
                <div class="warning-icon" id="warningIcon">‚ö†Ô∏è</div>
                
                <div class="water-level-indicator">
                    <div class="water-level-fill" id="waterLevelFill" style="height: 100%"></div>
                </div>
                
                <!-- Cleaning brush animation -->
                <svg class="cleaning-brush" id="cleaningBrush" viewBox="0 0 60 120">
                    <rect x="25" y="0" width="10" height="60" fill="#8B4513" rx="2"/>
                    <rect x="5" y="55" width="50" height="25" fill="#4a90d9" rx="5"/>
                    <rect x="8" y="80" width="6" height="35" fill="#2d5a87" rx="1"/>
                    <rect x="18" y="80" width="6" height="38" fill="#2d5a87" rx="1"/>
                    <rect x="28" y="80" width="6" height="35" fill="#2d5a87" rx="1"/>
                    <rect x="38" y="80" width="6" height="38" fill="#2d5a87" rx="1"/>
                    <rect x="48" y="80" width="6" height="35" fill="#2d5a87" rx="1"/>
                </svg>
                
                <!-- Plants -->
                <div class="plant plant-1">
                    <svg viewBox="0 0 35 90" fill="none">
                        <path d="M17 90 Q10 65 17 42 Q6 55 3 30 Q14 45 17 18 Q9 25 6 8 Q17 18 17 0" stroke="#1d6b3a" stroke-width="4" fill="none"/>
                        <path d="M17 90 Q24 65 17 42 Q28 55 32 30 Q21 45 17 18 Q25 25 29 8 Q17 18 17 0" stroke="#2d8a4e" stroke-width="4" fill="none"/>
                        <circle cx="5" cy="35" r="4" fill="#2d8a4e" opacity="0.6"/>
                        <circle cx="30" cy="28" r="3" fill="#3da55d" opacity="0.6"/>
                    </svg>
                </div>
                <div class="plant plant-2">
                    <svg viewBox="0 0 35 110" fill="none">
                        <path d="M17 110 Q8 80 17 52 Q3 68 0 32 Q14 52 17 22 Q7 32 3 10 Q17 22 17 0" stroke="#1a5c32" stroke-width="4" fill="none"/>
                        <path d="M17 110 Q26 80 17 52 Q31 68 35 32 Q21 52 17 22 Q27 32 32 10 Q17 22 17 0" stroke="#267d42" stroke-width="4" fill="none"/>
                    </svg>
                </div>
                <div class="plant plant-3">
                    <svg viewBox="0 0 30 75" fill="none">
                        <path d="M15 75 Q11 58 15 40 Q8 50 5 28 Q13 40 15 16 Q10 22 7 6 Q15 14 15 0" stroke="#1d6b3a" stroke-width="3" fill="none"/>
                        <path d="M15 75 Q19 58 15 40 Q22 50 25 28 Q17 40 15 16 Q20 22 23 6 Q15 14 15 0" stroke="#2d8a4e" stroke-width="3" fill="none"/>
                    </svg>
                </div>
                <div class="plant plant-4">
                    <svg viewBox="0 0 30 65" fill="none">
                        <path d="M15 65 Q10 50 15 35 Q7 44 5 24 Q12 35 15 14 Q10 19 8 6 Q15 12 15 0" stroke="#1a5c32" stroke-width="3" fill="none"/>
                        <path d="M15 65 Q20 50 15 35 Q23 44 25 24 Q18 35 15 14 Q20 19 22 6 Q15 12 15 0" stroke="#267d42" stroke-width="3" fill="none"/>
                    </svg>
                </div>
                
                <div class="rock rock-1"></div>
                <div class="rock rock-2"></div>
                
                <div class="castle">
                    <div class="castle-tower left"></div>
                    <div class="castle-tower right"></div>
                    <div class="castle-body">
                        <div class="castle-door"></div>
                    </div>
                </div>
                
                <div class="treasure">
                    <div class="treasure-box"></div>
                </div>
                
                <!-- Decoration slots -->
                <div class="decoration-slots" id="decoSlots">
                    <div class="deco-slot" data-slot="0" onclick="selectDecoSlot(0)"></div>
                    <div class="deco-slot" data-slot="1" onclick="selectDecoSlot(1)"></div>
                    <div class="deco-slot" data-slot="2" onclick="selectDecoSlot(2)"></div>
                    <div class="deco-slot" data-slot="3" onclick="selectDecoSlot(3)"></div>
                    <div class="deco-slot" data-slot="4" onclick="selectDecoSlot(4)"></div>
                </div>
                
                <div class="fish-count" id="fishCount">üêü 1/1 Fish</div>
                
                <div class="sand"></div>
                
                <!-- Fish SVG -->
                <svg class="fish" id="fish" viewBox="0 0 75 55">
                    <defs>
                        <linearGradient id="fishGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffb366"/>
                            <stop offset="30%" style="stop-color:#ff8533"/>
                            <stop offset="70%" style="stop-color:#ff6600"/>
                            <stop offset="100%" style="stop-color:#cc5200"/>
                        </linearGradient>
                        <linearGradient id="finGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff9966"/>
                            <stop offset="100%" style="stop-color:#e64d00"/>
                        </linearGradient>
                        <linearGradient id="bellyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffcc99"/>
                            <stop offset="100%" style="stop-color:#ffaa66"/>
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="1" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <!-- Tail fin -->
                    <path d="M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27" fill="url(#finGrad)">
                        <animate attributeName="d" dur="0.25s" repeatCount="indefinite"
                            values="M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27;
                                    M5 27 Q0 18 10 13 Q14 24 14 27 Q14 30 10 41 Q0 36 5 27;
                                    M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27"/>
                    </path>
                    <!-- Body -->
                    <ellipse cx="38" cy="27" rx="28" ry="20" fill="url(#fishGrad)"/>
                    <!-- Belly -->
                    <ellipse cx="40" cy="32" rx="18" ry="10" fill="url(#bellyGrad)" opacity="0.5"/>
                    <!-- Dorsal fin -->
                    <path d="M32 8 Q38 -2 50 4 Q45 12 38 10 Z" fill="url(#finGrad)">
                        <animate attributeName="d" dur="0.4s" repeatCount="indefinite"
                            values="M32 8 Q38 -2 50 4 Q45 12 38 10 Z;
                                    M32 8 Q38 1 50 6 Q45 12 38 10 Z;
                                    M32 8 Q38 -2 50 4 Q45 12 38 10 Z"/>
                    </path>
                    <!-- Anal fin -->
                    <path d="M32 46 Q38 54 46 50 Q42 44 36 45 Z" fill="url(#finGrad)"/>
                    <!-- Pectoral fin -->
                    <ellipse cx="35" cy="32" rx="10" ry="5" fill="url(#finGrad)" opacity="0.85">
                        <animate attributeName="ry" dur="0.35s" repeatCount="indefinite" values="5;3.5;5"/>
                    </ellipse>
                    <!-- Scales pattern -->
                    <path d="M25 22 Q32 19 38 22 Q32 25 25 22" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                    <path d="M32 30 Q39 27 46 30 Q39 33 32 30" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                    <path d="M20 28 Q27 25 33 28 Q27 31 20 28" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                    <path d="M40 22 Q46 20 52 22 Q46 24 40 22" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                    <!-- Eye -->
                    <ellipse cx="54" cy="22" rx="8" ry="9" fill="white"/>
                    <circle cx="56" cy="22" r="5" fill="#1a1a2e"/>
                    <circle cx="57" cy="20" r="2" fill="white"/>
                    <ellipse cx="54" cy="22" rx="8" ry="9" fill="none" stroke="#ddd" stroke-width="0.5"/>
                    <!-- Eyebrow/lid hint -->
                    <path d="M48 16 Q54 14 60 16" fill="none" stroke="#cc5200" stroke-width="1" opacity="0.5"/>
                    <!-- Mouth -->
                    <ellipse class="fish-mouth" cx="64" cy="30" rx="4" ry="2.5" fill="#cc3300" opacity="0.85"/>
                    <!-- Gill -->
                    <path d="M45 25 Q43 30 45 35" fill="none" stroke="#cc5200" stroke-width="1.5" opacity="0.4"/>
                </svg>
                
                <div class="game-over" id="gameOver">
                    <h2>Game Over</h2>
                    <p class="death-reason" id="deathReason">Bubbles has passed away</p>
                    <p>Survived for <span id="finalScore">0</span> seconds</p>
                    <p>Earned <span id="finalCoins">0</span> coins</p>
                    <button class="btn btn-restart" onclick="restartGame()">üîÑ Try Again</button>
                </div>
            </div>
        </div>
        
        <div class="stats-panel">
            <div class="fish-name">
                <span>üêü Bubbles</span>
            </div>
            
            <div class="coin-display">
                <span class="coin-icon">ü™ô</span>
                <span class="coin-value" id="coins">0</span>
            </div>
            
            <div class="score-display">
                <div class="score-label">SURVIVAL TIME</div>
                <div class="score-value" id="score">0</div>
            </div>
            
            <div class="stat">
                <div class="stat-label"><span class="stat-icon">üçñ</span> Hunger</div>
                <div class="stat-bar">
                    <div class="stat-fill hunger-fill" id="hungerBar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat">
                <div class="stat-label"><span class="stat-icon">üíß</span> Water Level</div>
                <div class="stat-bar">
                    <div class="stat-fill water-fill" id="waterBar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat">
                <div class="stat-label"><span class="stat-icon">üòä</span> Happiness</div>
                <div class="stat-bar">
                    <div class="stat-fill happiness-fill" id="happinessBar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat">
                <div class="stat-label"><span class="stat-icon">‚ù§Ô∏è</span> Health</div>
                <div class="stat-bar">
                    <div class="stat-fill health-fill" id="healthBar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat">
                <div class="stat-label"><span class="stat-icon">‚ú®</span> Water Quality</div>
                <div class="stat-bar">
                    <div class="stat-fill cleanliness-fill" id="cleanlinessBar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-feed" onclick="dropFood()" id="feedBtn">üçï Feed</button>
                <button class="btn btn-water" onclick="addWater()" id="waterBtn">üíß Water (<span id="waterBottles">3</span>)</button>
                <button class="btn btn-clean" onclick="cleanTank()">üßπ Clean</button>
                <button class="btn btn-play" onclick="playWithFish()">üéæ Play</button>
                <button class="btn btn-shop" onclick="openShop()">üõí Shop</button>
                <button class="btn" style="background: linear-gradient(145deg, #e056fd 0%, #be2edd 100%); color: white;" onclick="openCustomize()">üé® Customize</button>
            </div>
        </div>
    </div>
    
    <p class="instructions">
        üê† Keep Bubbles alive! Feed wisely - overfeeding kills! üíÄ Water evaporates - buy bottles in shop!
        <br>üé® Customize your fish! üè∞ Place decorations in slots. üí∞ Earn 10 coins every 10 seconds.
        <br>üíé Get the premium Big Tank to hold up to 9 fish! üêå Buy cleaner animals to help maintain tank.
    </p>
    
    <!-- Mobile cheat code input -->
    <div class="mobile-code-input" id="mobileCodeWrapper">
        <input type="text" id="mobileCodeInput" placeholder="üêü Secret code..." maxlength="15" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    </div>

    <!-- Shop Modal -->
    <div class="modal-overlay" id="shopModal">
        <div class="shop-modal">
            <div class="shop-header">
                <h2 class="shop-title">üõí Fish Shop</h2>
                <button class="close-btn" onclick="closeShop()">‚úï</button>
            </div>
            
            <div class="shop-section" id="fishSection" style="display:none;">
                <h3 class="section-title">üêü Buy Fish</h3>
                <div class="shop-items" id="fishItems"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">üíß Water & Supplies</h3>
                <div class="shop-items" id="supplyItems"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">üêå Cleaner Animals</h3>
                <div class="shop-items" id="cleanerItems"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">üè∞ Decorations</h3>
                <div class="shop-items" id="decorationItems"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">‚¨ÜÔ∏è Upgrades</h3>
                <div class="shop-items" id="upgradeItems"></div>
            </div>
            
            <div class="premium-section">
                <div class="premium-title">üèÜ PREMIUM - Big Tank!</div>
                <div class="premium-desc">Upgrade to a massive tank that holds up to 9 fish! More space = more fun!</div>
                <button class="btn btn-premium" onclick="purchaseBigTank()" id="premiumBtn">üíé $4.99 USD - Unlock Big Tank</button>
            </div>
        </div>
    </div>
    
    <!-- Customize Modal -->
    <div class="modal-overlay" id="customizeModal">
        <div class="shop-modal">
            <div class="shop-header">
                <h2 class="shop-title">üé® Customize Bubbles</h2>
                <button class="close-btn" onclick="closeCustomize()">‚úï</button>
            </div>
            
            <div class="fish-preview" id="fishPreview">
                <svg viewBox="0 0 75 55" style="width:100%;height:100%;">
                    <defs>
                        <linearGradient id="previewGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" id="previewColor1" style="stop-color:#ffb366"/>
                            <stop offset="50%" id="previewColor2" style="stop-color:#ff8533"/>
                            <stop offset="100%" id="previewColor3" style="stop-color:#cc5200"/>
                        </linearGradient>
                    </defs>
                    <path d="M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27" fill="url(#previewGrad)"/>
                    <ellipse cx="38" cy="27" rx="28" ry="20" fill="url(#previewGrad)"/>
                    <path d="M32 8 Q38 -2 50 4 Q45 12 38 10 Z" fill="url(#previewGrad)"/>
                    <ellipse cx="54" cy="22" rx="8" ry="9" fill="white"/>
                    <circle cx="56" cy="22" r="5" fill="#1a1a2e"/>
                    <circle cx="57" cy="20" r="2" fill="white"/>
                    <ellipse cx="64" cy="30" rx="4" ry="2.5" fill="#cc3300" opacity="0.85"/>
                    <text x="38" y="50" id="previewAccessory" font-size="12" text-anchor="middle"></text>
                </svg>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">üé® Colors</h3>
                <div class="color-options" id="colorOptions"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">‚ú® Patterns</h3>
                <div class="pattern-options" id="patternOptions"></div>
            </div>
            
            <div class="shop-section">
                <h3 class="section-title">üëí Accessories</h3>
                <div class="accessory-options" id="accessoryOptions"></div>
            </div>
            
            <button class="btn" style="width:100%;background:linear-gradient(145deg,#6bcb77,#4ade80);color:white;margin-top:10px;" onclick="applyCustomization()">‚úÖ Apply Changes</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            hunger: 70,
            happiness: 100,
            health: 100,
            cleanliness: 100,
            waterLevel: 100,
            score: 0,
            coins: 0,
            isAlive: true,
            isEscaped: false,
            foodCount: 0,
            uneatenFood: 0,
            overfedLevel: 0,
            deathReason: '',
            lastCoinTime: 0,
            waterBottles: 3,
            hasBigTank: false,
            maxFish: 1,
            currentFish: 1
        };

        // Fish customization
        let fishCustomization = {
            color: 'orange',
            pattern: 'none',
            accessory: 'none'
        };

        const fishColors = {
            orange: { c1: '#ffb366', c2: '#ff8533', c3: '#cc5200', price: 0 },
            gold: { c1: '#ffd700', c2: '#ffaa00', c3: '#cc8800', price: 0 },
            blue: { c1: '#66b3ff', c2: '#3399ff', c3: '#0066cc', price: 50 },
            purple: { c1: '#b366ff', c2: '#9933ff', c3: '#6600cc', price: 50 },
            pink: { c1: '#ff99cc', c2: '#ff66b2', c3: '#cc3385', price: 75 },
            green: { c1: '#66ff99', c2: '#33cc66', c3: '#009933', price: 75 },
            red: { c1: '#ff6666', c2: '#ff3333', c3: '#cc0000', price: 100 },
            rainbow: { c1: '#ff6b6b', c2: '#4ecdc4', c3: '#9b59b6', price: 200 },
            galaxy: { c1: '#1a1a3e', c2: '#4a1a6b', c3: '#0f2847', price: 300 }
        };

        const fishPatterns = [
            { id: 'none', name: 'None', price: 0 },
            { id: 'stripes', name: 'ü¶ì Stripes', price: 80 },
            { id: 'spots', name: 'üêÜ Spots', price: 80 },
            { id: 'stars', name: '‚≠ê Stars', price: 150 },
            { id: 'hearts', name: 'üíñ Hearts', price: 150 }
        ];

        const fishAccessories = [
            { id: 'none', name: 'None', icon: '', price: 0 },
            { id: 'crown', name: 'üëë Crown', icon: 'üëë', price: 100 },
            { id: 'tophat', name: 'üé© Top Hat', icon: 'üé©', price: 100 },
            { id: 'bow', name: 'üéÄ Bow', icon: 'üéÄ', price: 75 },
            { id: 'glasses', name: 'üï∂Ô∏è Sunglasses', icon: 'üï∂Ô∏è', price: 80 },
            { id: 'party', name: 'üéâ Party Hat', icon: 'ü•≥', price: 120 }
        ];

        let ownedCustomizations = {
            colors: ['orange', 'gold'],
            patterns: ['none'],
            accessories: ['none']
        };

        // Decoration slots
        let decoSlots = [null, null, null, null, null];
        let selectedSlot = null;

        // Fish position and movement
        let fish = {
            x: 280,
            y: 200,
            targetX: 280,
            targetY: 200,
            speed: 2.5,
            facingRight: true,
            goingToFood: false
        };

        // Tank dimensions
        let tankWidth = 650;
        let tankHeight = 480;

        // Items and animals
        let foodItems = [];
        let cleanerAnimals = [];
        let decorations = [];
        let extraFish = []; // Additional fish beyond Bubbles

        // Shop items
        const shopData = {
            supplies: [
                { id: 'water1', name: 'Water Bottle', icon: 'üíß', price: 20, amount: 1, type: 'water' },
                { id: 'water3', name: 'Water Pack (3)', icon: 'üí¶', price: 50, amount: 3, type: 'water' },
                { id: 'water10', name: 'Water Crate (10)', icon: 'üö∞', price: 150, amount: 10, type: 'water' },
                { id: 'food5', name: 'Premium Food', icon: 'üçñ', price: 40, type: 'food', desc: '+10 hunger per bite' }
            ],
            cleaners: [
                { id: 'snail', name: 'Snail', icon: 'üêå', price: 50, cleanRate: 0.3, desc: 'Slowly cleans algae' },
                { id: 'shrimp', name: 'Shrimp', icon: 'ü¶ê', price: 80, cleanRate: 0.5, desc: 'Eats leftover food' },
                { id: 'pleco', name: 'Pleco', icon: 'üêü', price: 150, cleanRate: 1, desc: 'Master cleaner fish' },
                { id: 'crab', name: 'Crab', icon: 'ü¶Ä', price: 200, cleanRate: 1.5, desc: 'Cleans everything!' }
            ],
            decorations: [
                { id: 'coral1', name: 'Pink Coral', icon: 'ü™∏', price: 30, happiness: 5, slot: true },
                { id: 'shell', name: 'Seashell', icon: 'üêö', price: 25, happiness: 3, slot: true },
                { id: 'anchor', name: 'Anchor', icon: '‚öì', price: 60, happiness: 8, slot: true },
                { id: 'diver', name: 'Diver', icon: 'ü§ø', price: 100, happiness: 12, slot: true },
                { id: 'submarine', name: 'Submarine', icon: 'üö§', price: 200, happiness: 20, slot: true },
                { id: 'mermaid', name: 'Mermaid', icon: 'üßú‚Äç‚ôÄÔ∏è', price: 180, happiness: 18, slot: true },
                { id: 'octopus', name: 'Octopus', icon: 'üêô', price: 90, happiness: 10, slot: true }
            ],
            upgrades: [
                { id: 'filter', name: 'Water Filter', icon: 'üîÑ', price: 100, effect: 'slowEvaporation' },
                { id: 'lid', name: 'Tank Lid', icon: 'üîí', price: 150, effect: 'preventEscape' },
                { id: 'autofeeder', name: 'Auto Feeder', icon: '‚è∞', price: 250, effect: 'autoFeed' },
                { id: 'heater', name: 'Heater', icon: 'üå°Ô∏è', price: 120, effect: 'healthBoost' }
            ]
        };

        let ownedItems = {
            cleaners: [],
            decorations: [],
            upgrades: []
        };

        // Cheat code system
        let cheatBuffer = '';
        let cheatActive = false;
        let cheatInterval = null;
        let fishStormActive = false;

        // DOM elements
        const tank = document.getElementById('tank');
        const fishEl = document.getElementById('fish');
        const dirtyOverlay = document.getElementById('dirtyOverlay');
        const waterSurface = document.getElementById('waterSurface');
        const cleaningBrush = document.getElementById('cleaningBrush');
        const warningIcon = document.getElementById('warningIcon');

        // Update tank dimensions
        function updateTankDimensions() {
            const rect = tank.getBoundingClientRect();
            tankWidth = rect.width;
            tankHeight = rect.height;
            
            fish.x = Math.min(fish.x, tankWidth - 80);
            fish.y = Math.min(fish.y, tankHeight - 110);
            fish.targetX = Math.min(fish.targetX, tankWidth - 80);
            fish.targetY = Math.min(fish.targetY, tankHeight - 110);
        }

        // Initialize game
        function init() {
            updateTankDimensions();
            window.addEventListener('resize', updateTankDimensions);
            
            updateFishPosition();
            renderShop();
            
            setInterval(gameLoop, 50);
            setInterval(updateStats, 1000);
            setInterval(spawnBubble, 2500);
            setInterval(moveFishRandomly, 2500);
            setInterval(coinTick, 10000);
            setInterval(checkEscape, 3000);
            setInterval(moveCleaners, 100);
            
            tank.addEventListener('click', handleInteraction);
            tank.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleInteraction({ clientX: touch.clientX, clientY: touch.clientY });
            }, { passive: false });
            
            // Cheat code listener
            document.addEventListener('keypress', handleCheatCode);
            
            // Mobile cheat code input
            const mobileInput = document.getElementById('mobileCodeInput');
            mobileInput.addEventListener('input', handleMobileCheatCode);
        }
        
        function handleMobileCheatCode(e) {
            const input = e.target;
            const value = input.value.toLowerCase();
            
            if (value === 'mochi1234' && !cheatActive) {
                activateCheat();
                input.classList.add('success');
                input.value = 'üéâ COINS!';
                setTimeout(() => {
                    input.value = '';
                    input.classList.remove('success');
                }, 1500);
            }
            
            if (value === 'fishsticksquash' && !fishStormActive) {
                activateFishStorm();
                input.classList.add('success');
                input.value = 'üêü STORM!';
                setTimeout(() => {
                    input.value = '';
                    input.classList.remove('success');
                }, 1500);
            }
        }

        function handleCheatCode(e) {
            cheatBuffer += e.key.toLowerCase();
            
            // Keep only last 16 characters (for longer cheat codes)
            if (cheatBuffer.length > 16) {
                cheatBuffer = cheatBuffer.slice(-16);
            }
            
            // Check for cheat codes
            if (cheatBuffer.includes('mochi1234') && !cheatActive) {
                activateCheat();
            }
            if (cheatBuffer.includes('fishsticksquash') && !fishStormActive) {
                activateFishStorm();
            }
        }

        function activateCheat() {
            cheatActive = true;
            console.log('üêü CHEAT ACTIVATED: mochi1234 - 1,000,000 coins/sec!');
            
            // Show activation message
            const msg = document.createElement('div');
            msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,#ffd700,#ff8c00);color:#000;padding:20px 40px;border-radius:15px;font-family:"Fredoka One",cursive;font-size:1.5rem;z-index:9999;text-align:center;box-shadow:0 0 50px rgba(255,215,0,0.8);animation:cheatPulse 0.5s ease-in-out;';
            msg.innerHTML = 'üéâ CHEAT ACTIVATED! üéâ<br>üí∞ 1,000,000 coins/sec! üí∞';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
            
            // Add coin rain every second
            cheatInterval = setInterval(() => {
                if (gameState.isAlive) {
                    gameState.coins += 1000000;
                    document.getElementById('coins').textContent = gameState.coins.toLocaleString();
                }
            }, 1000);
        }

        function activateFishStorm() {
            if (!gameState.hasBigTank) {
                const msg = document.createElement('div');
                msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,#ff6b6b,#ee5a5a);color:#fff;padding:20px 40px;border-radius:15px;font-family:"Fredoka One",cursive;font-size:1.2rem;z-index:9999;text-align:center;box-shadow:0 0 50px rgba(255,107,107,0.8);';
                msg.innerHTML = 'üîí Need Big Tank! üîí<br>Buy the expansion first!';
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 2000);
                return;
            }
            
            fishStormActive = true;
            console.log('üêü CHEAT ACTIVATED: fishsticksquash - Fish Storm!');
            
            // Show activation message
            const msg = document.createElement('div');
            msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,#4ecdc4,#45b7aa);color:#fff;padding:20px 40px;border-radius:15px;font-family:"Fredoka One",cursive;font-size:1.5rem;z-index:9999;text-align:center;box-shadow:0 0 50px rgba(78,205,196,0.8);';
            msg.innerHTML = 'üåä FISH STORM! üåä<br>üêüüê†üê° Raining Fish! üê°üê†üêü';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
            
            // Rain fish into the tank
            let fishRained = 0;
            const maxRain = gameState.maxFish - gameState.currentFish;
            
            if (maxRain <= 0) {
                const fullMsg = document.createElement('div');
                fullMsg.style.cssText = 'position:fixed;top:60%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,#ffd93d,#f9c80e);color:#333;padding:15px 30px;border-radius:15px;font-family:"Fredoka One",cursive;font-size:1rem;z-index:9999;text-align:center;';
                fullMsg.innerHTML = 'üêü Tank is full! üêü';
                document.body.appendChild(fullMsg);
                setTimeout(() => fullMsg.remove(), 2000);
                fishStormActive = false;
                return;
            }
            
            const stormInterval = setInterval(() => {
                if (fishRained >= maxRain || gameState.currentFish >= gameState.maxFish) {
                    clearInterval(stormInterval);
                    fishStormActive = false;
                    return;
                }
                
                spawnNewFish();
                fishRained++;
                
                // Visual effect - fish falling from top
                const fallingFish = document.createElement('div');
                fallingFish.style.cssText = `position:absolute;top:-50px;left:${50 + Math.random() * (tankWidth - 100)}px;font-size:30px;z-index:100;animation:fishFall 1s ease-in forwards;pointer-events:none;`;
                fallingFish.innerHTML = ['üêü', 'üê†', 'üê°'][Math.floor(Math.random() * 3)];
                tank.appendChild(fallingFish);
                setTimeout(() => fallingFish.remove(), 1000);
            }, 400);
        }

        function handleInteraction(e) {
            if (!gameState.isAlive || gameState.isEscaped) return;
            const rect = tank.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            createFood(x, y);
        }

        // Game loop
        function gameLoop() {
            if (!gameState.isAlive) return;
            
            if (!gameState.isEscaped) {
                moveFish();
                moveExtraFish();
                checkFoodCollision();
            }
            updateVisuals();
        }

        // Fish movement
        function moveFish() {
            const dx = fish.targetX - fish.x;
            const dy = fish.targetY - fish.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            
            const scaledSpeed = fish.speed * (tankWidth / 650);
            
            if (dist > 5) {
                fish.x += (dx / dist) * scaledSpeed;
                fish.y += (dy / dist) * scaledSpeed;
                
                if (dx > 0 && !fish.facingRight) {
                    fish.facingRight = true;
                    fishEl.classList.remove('flip');
                } else if (dx < 0 && fish.facingRight) {
                    fish.facingRight = false;
                    fishEl.classList.add('flip');
                }
            } else {
                fish.goingToFood = false;
            }
            
            updateFishPosition();
        }

        function updateFishPosition() {
            fishEl.style.left = fish.x + 'px';
            fishEl.style.top = fish.y + 'px';
        }

        // Random movement
        function moveFishRandomly() {
            if (!gameState.isAlive || gameState.isEscaped) return;
            
            const sandHeight = tankHeight * 0.115;
            const waterTop = tankHeight * (1 - gameState.waterLevel / 100) + 20;
            const maxY = tankHeight - sandHeight - 65;
            
            // Priority: go to food if hungry and food exists
            if (gameState.hunger < 70 && foodItems.length > 0 && !fish.goingToFood) {
                const nearestFood = foodItems[0];
                const fishWidth = 75 * (tankWidth / 650);
                fish.targetX = nearestFood.x - fishWidth / 2;
                fish.targetY = Math.max(waterTop, nearestFood.y - 30);
                fish.goingToFood = true;
                fish.speed = 3.5;
            } else if (!fish.goingToFood) {
                fish.targetX = 40 + Math.random() * (tankWidth - 120);
                fish.targetY = Math.max(waterTop, 40) + Math.random() * (maxY - waterTop);
                fish.speed = 2.5;
            }
        }

        // Create food
        function createFood(x, y) {
            // Check for overfeeding
            if (gameState.uneatenFood >= 5) {
                showWarning();
                return;
            }
            
            const food = document.createElement('div');
            food.className = 'food sinking';
            food.style.left = x + 'px';
            food.style.top = Math.max(20, y) + 'px';
            tank.appendChild(food);
            
            const foodObj = { 
                element: food, 
                x: x, 
                y: Math.max(20, y),
                sinkSpeed: 0.5,
                eaten: false
            };
            foodItems.push(foodObj);
            gameState.uneatenFood++;
            gameState.foodCount++;
            
            // Fish goes to food
            if (gameState.hunger < 90) {
                const fishWidth = 75 * (tankWidth / 650);
                fish.targetX = x - fishWidth / 2;
                fish.targetY = Math.max(20, y) - 30;
                fish.goingToFood = true;
                fish.speed = 3.5;
            }
        }

        // Food sinking and decay
        function updateFood() {
            const sandTop = tankHeight - 55;
            
            for (let i = foodItems.length - 1; i >= 0; i--) {
                const food = foodItems[i];
                if (!food.eaten) {
                    food.y += food.sinkSpeed;
                    food.element.style.top = food.y + 'px';
                    
                    // Food reached bottom - decays and dirties water
                    if (food.y >= sandTop - 10) {
                        food.element.remove();
                        foodItems.splice(i, 1);
                        gameState.cleanliness = Math.max(0, gameState.cleanliness - 5);
                        // Uneaten food stays counted for overfeeding
                    }
                }
            }
        }

        // Check food collision
        function checkFoodCollision() {
            const fishWidth = 75 * (tankWidth / 650);
            const collisionDist = fishWidth * 0.5;
            
            for (let i = foodItems.length - 1; i >= 0; i--) {
                const food = foodItems[i];
                if (food.eaten) continue;
                
                const dx = (fish.x + fishWidth / 2) - food.x;
                const dy = (fish.y + 27) - food.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < collisionDist) {
                    food.element.remove();
                    food.eaten = true;
                    foodItems.splice(i, 1);
                    gameState.uneatenFood = Math.max(0, gameState.uneatenFood - 1);
                    
                    fishEl.classList.add('eating');
                    setTimeout(() => fishEl.classList.remove('eating'), 600);
                    
                    // Eating increases hunger but can overfeed
                    const hungerGain = 25;
                    gameState.hunger = Math.min(120, gameState.hunger + hungerGain);
                    
                    if (gameState.hunger > 100) {
                        gameState.overfedLevel += (gameState.hunger - 100);
                        gameState.hunger = 100;
                        
                        if (gameState.overfedLevel > 50) {
                            fishEl.classList.add('overfed');
                        }
                    }
                    
                    gameState.happiness = Math.min(100, gameState.happiness + 3);
                    fish.goingToFood = false;
                    moveFishRandomly();
                }
            }
        }

        // Update stats over time
        function updateStats() {
            if (!gameState.isAlive) return;
            
            // Hunger decreases
            gameState.hunger = Math.max(0, gameState.hunger - 2.5);
            
            // Overfed level slowly decreases
            if (gameState.overfedLevel > 0) {
                gameState.overfedLevel = Math.max(0, gameState.overfedLevel - 2);
                if (gameState.overfedLevel <= 50) {
                    fishEl.classList.remove('overfed');
                }
            }
            
            // Water evaporates and fish drinks
            let evaporationRate = 0.4;
            if (ownedItems.upgrades.includes('filter')) evaporationRate = 0.2;
            gameState.waterLevel = Math.max(0, gameState.waterLevel - evaporationRate);
            
            // Happiness decreases
            gameState.happiness = Math.max(0, gameState.happiness - 0.8);
            
            // Cleanliness decreases (cleaner animals help)
            let cleanBonus = 0;
            cleanerAnimals.forEach(animal => {
                const data = shopData.cleaners.find(c => c.id === animal.type);
                if (data) cleanBonus += data.cleanRate;
            });
            gameState.cleanliness = Math.min(100, Math.max(0, gameState.cleanliness - 0.6 + cleanBonus));
            
            // Decoration happiness bonus
            let decoBonus = 0;
            ownedItems.decorations.forEach(id => {
                const data = shopData.decorations.find(d => d.id === id);
                if (data) decoBonus += data.happiness * 0.02;
            });
            gameState.happiness = Math.min(100, gameState.happiness + decoBonus);
            
            // Health effects
            if (gameState.hunger < 20) {
                gameState.health = Math.max(0, gameState.health - 4);
            }
            if (gameState.cleanliness < 25) {
                gameState.health = Math.max(0, gameState.health - 3);
            }
            if (gameState.waterLevel < 30) {
                gameState.health = Math.max(0, gameState.health - 5);
            }
            if (gameState.overfedLevel > 30) {
                gameState.health = Math.max(0, gameState.health - 4);
            }
            if (gameState.isEscaped) {
                gameState.health = Math.max(0, gameState.health - 8);
            }
            
            // Health regeneration when conditions are good
            if (gameState.hunger > 50 && gameState.cleanliness > 60 && gameState.waterLevel > 50 && 
                gameState.overfedLevel < 20 && !gameState.isEscaped) {
                let regenRate = 0.8;
                if (ownedItems.upgrades.includes('heater')) regenRate = 1.5;
                gameState.health = Math.min(100, gameState.health + regenRate);
            }
            
            // Happiness from hunger
            if (gameState.hunger < 15) {
                gameState.happiness = Math.max(0, gameState.happiness - 3);
            }
            
            // Update score
            gameState.score++;
            document.getElementById('score').textContent = gameState.score;
            
            // Update food positions
            updateFood();
            
            // Auto feeder
            if (ownedItems.upgrades.includes('autofeeder') && gameState.hunger < 40 && gameState.uneatenFood < 2) {
                const x = 100 + Math.random() * (tankWidth - 200);
                createFood(x, 30);
            }
            
            // Check for death
            checkDeath();
            
            updateVisuals();
        }

        function checkDeath() {
            if (gameState.health <= 0) {
                if (gameState.isEscaped) {
                    gameState.deathReason = "üíÄ Bubbles jumped out and couldn't breathe!";
                } else if (gameState.overfedLevel > 30) {
                    gameState.deathReason = "üçî Bubbles was overfed and got sick!";
                } else if (gameState.waterLevel < 30) {
                    gameState.deathReason = "üíß The water level got too low!";
                } else if (gameState.hunger < 20) {
                    gameState.deathReason = "üò¢ Bubbles starved from hunger!";
                } else if (gameState.cleanliness < 25) {
                    gameState.deathReason = "ü¶† The tank got too dirty!";
                } else {
                    gameState.deathReason = "üíî Bubbles has passed away";
                }
                gameOver();
            }
        }

        // Coin earning every 10 seconds
        function coinTick() {
            if (!gameState.isAlive || gameState.isEscaped) return;
            
            const coinsEarned = 10;
            gameState.coins += coinsEarned;
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            
            // Visual feedback
            const coinEl = document.querySelector('.coin-icon');
            coinEl.style.transform = 'scale(1.3)';
            setTimeout(() => coinEl.style.transform = '', 200);
        }

        // Fish escape mechanic
        function checkEscape() {
            if (!gameState.isAlive || gameState.isEscaped) return;
            if (ownedItems.upgrades.includes('lid')) return;
            
            // Fish can escape if water is high and fish is near top and unhappy
            if (gameState.waterLevel > 80 && fish.y < 60 && gameState.happiness < 40) {
                const escapeChance = (100 - gameState.happiness) / 500;
                if (Math.random() < escapeChance) {
                    fishEscapes();
                }
            }
        }

        function fishEscapes() {
            gameState.isEscaped = true;
            fishEl.classList.add('escaped');
            
            // Move fish above tank
            fishEl.style.top = '-50px';
            fishEl.style.left = fish.x + 'px';
            
            showWarning();
        }

        function rescueFish() {
            if (!gameState.isEscaped) return;
            
            gameState.isEscaped = false;
            fishEl.classList.remove('escaped');
            fish.y = 100;
            fish.targetY = 150;
            updateFishPosition();
            warningIcon.classList.remove('show');
        }

        // Show warning
        function showWarning() {
            warningIcon.classList.add('show');
            setTimeout(() => warningIcon.classList.remove('show'), 2000);
        }

        // Update visuals
        function updateVisuals() {
            document.getElementById('hungerBar').style.width = Math.min(100, gameState.hunger) + '%';
            document.getElementById('happinessBar').style.width = gameState.happiness + '%';
            document.getElementById('healthBar').style.width = gameState.health + '%';
            document.getElementById('cleanlinessBar').style.width = gameState.cleanliness + '%';
            document.getElementById('waterBar').style.width = gameState.waterLevel + '%';
            document.getElementById('waterLevelFill').style.height = gameState.waterLevel + '%';
            
            // Water surface position
            const waterTop = (100 - gameState.waterLevel) * (tankHeight - 60) / 100;
            waterSurface.style.top = waterTop + 'px';
            
            // Bar colors
            updateBarColor('hungerBar', gameState.hunger);
            updateBarColor('happinessBar', gameState.happiness);
            updateBarColor('healthBar', gameState.health);
            updateBarColor('cleanlinessBar', gameState.cleanliness);
            updateBarColor('waterBar', gameState.waterLevel);
            
            // Dirty overlay
            const dirtiness = (100 - gameState.cleanliness) / 100;
            const greenIntensity = Math.floor(60 + dirtiness * 120);
            const redIntensity = Math.floor(30 + dirtiness * 50);
            const blueIntensity = Math.floor(20 + dirtiness * 25);
            dirtyOverlay.style.background = `rgba(${redIntensity}, ${greenIntensity}, ${blueIntensity}, ${dirtiness * 0.6})`;
            
            // Fish speed based on hunger
            if (!fish.goingToFood) {
                fish.speed = gameState.hunger > 30 ? 2.5 : 1.5;
            }
        }

        function updateBarColor(barId, value) {
            const bar = document.getElementById(barId);
            if (value < 20) {
                bar.style.filter = 'hue-rotate(-30deg) saturate(1.5)';
            } else if (value < 40) {
                bar.style.filter = 'hue-rotate(-15deg)';
            } else {
                bar.style.filter = 'none';
            }
        }

        // Spawn bubbles
        function spawnBubble() {
            if (!gameState.isAlive) return;
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            const size = 6 + Math.random() * 18;
            bubble.style.width = size + 'px';
            bubble.style.height = size + 'px';
            bubble.style.left = (40 + Math.random() * (tankWidth - 80)) + 'px';
            bubble.style.bottom = (tankHeight * 0.12) + 'px';
            tank.appendChild(bubble);
            
            setTimeout(() => bubble.remove(), 4000);
        }

        // Button actions
        function dropFood() {
            if (!gameState.isAlive || gameState.isEscaped) return;
            
            if (gameState.uneatenFood >= 5) {
                showWarning();
                return;
            }
            
            const x = 80 + Math.random() * (tankWidth - 160);
            createFood(x, 30);
        }

        function addWater() {
            if (!gameState.isAlive) return;
            if (gameState.waterBottles <= 0) {
                showWarning();
                return;
            }
            
            gameState.waterBottles--;
            document.getElementById('waterBottles').textContent = gameState.waterBottles;
            gameState.waterLevel = Math.min(100, gameState.waterLevel + 25);
            
            // If fish escaped and we add water, they might come back
            if (gameState.isEscaped && gameState.waterLevel > 60) {
                rescueFish();
            }
            
            updateVisuals();
        }

        function cleanTank() {
            if (!gameState.isAlive) return;
            
            // Show cleaning animation
            cleaningBrush.style.left = '50%';
            cleaningBrush.style.top = '20%';
            cleaningBrush.classList.add('active');
            
            // Spawn sparkles
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'clean-sparkle';
                    sparkle.innerHTML = '‚ú®';
                    sparkle.style.left = (100 + Math.random() * (tankWidth - 200)) + 'px';
                    sparkle.style.top = (50 + Math.random() * (tankHeight - 150)) + 'px';
                    sparkle.style.fontSize = (15 + Math.random() * 15) + 'px';
                    tank.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 600);
                }, i * 150);
            }
            
            setTimeout(() => {
                cleaningBrush.classList.remove('active');
                gameState.cleanliness = Math.min(100, gameState.cleanliness + 35);
                gameState.happiness = Math.min(100, gameState.happiness + 5);
                
                // Remove uneaten food from bottom
                for (let i = foodItems.length - 1; i >= 0; i--) {
                    const food = foodItems[i];
                    if (food.y > tankHeight - 100) {
                        food.element.remove();
                        foodItems.splice(i, 1);
                        gameState.uneatenFood = Math.max(0, gameState.uneatenFood - 1);
                    }
                }
                
                updateVisuals();
            }, 1500);
        }

        function playWithFish() {
            if (!gameState.isAlive) return;
            
            if (gameState.isEscaped) {
                rescueFish();
                gameState.happiness = Math.min(100, gameState.happiness + 10);
                return;
            }
            
            gameState.happiness = Math.min(100, gameState.happiness + 20);
            gameState.hunger = Math.max(0, gameState.hunger - 4);
            
            const sandHeight = tankHeight * 0.115;
            const maxY = tankHeight - sandHeight - 65;
            
            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    if (!gameState.isAlive) return;
                    fish.targetX = 40 + Math.random() * (tankWidth - 120);
                    fish.targetY = 40 + Math.random() * maxY;
                    fish.speed = 5;
                }, i * 400);
            }
            setTimeout(() => fish.speed = 2.5, 2000);
            
            updateVisuals();
        }

        // Cleaner animal movement
        function moveCleaners() {
            cleanerAnimals.forEach(animal => {
                // Simple movement along bottom/sides
                animal.x += animal.dx;
                
                if (animal.x < 20 || animal.x > tankWidth - 50) {
                    animal.dx *= -1;
                    animal.element.classList.toggle('flip');
                }
                
                animal.element.style.left = animal.x + 'px';
            });
        }

        // Shop functions
        function openShop() {
            document.getElementById('shopModal').classList.add('show');
            renderShop();
        }

        function closeShop() {
            document.getElementById('shopModal').classList.remove('show');
        }

        function renderShop() {
            // Fish section (only with Big Tank)
            const fishSection = document.getElementById('fishSection');
            const fishContainer = document.getElementById('fishItems');
            
            if (gameState.hasBigTank) {
                fishSection.style.display = 'block';
                fishContainer.innerHTML = '';
                
                const fishPrice = 100;
                const canAfford = gameState.coins >= fishPrice;
                const tankFull = gameState.currentFish >= gameState.maxFish;
                
                const div = document.createElement('div');
                div.className = `shop-item ${tankFull ? 'owned' : ''} ${!canAfford && !tankFull ? 'disabled' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">üê†</div>
                    <div class="item-name">New Fish Friend</div>
                    ${tankFull ? '<div class="item-owned">Tank Full!</div>' : `<div class="item-price">ü™ô ${fishPrice}</div>`}
                    <div style="font-size:0.7rem;color:#7ec8e3;margin-top:5px;">${gameState.currentFish}/${gameState.maxFish} fish</div>
                `;
                if (!tankFull && canAfford) {
                    div.onclick = () => buyFish();
                }
                fishContainer.appendChild(div);
            } else {
                fishSection.style.display = 'none';
            }
            
            // Supplies (consumables)
            const supplyContainer = document.getElementById('supplyItems');
            supplyContainer.innerHTML = '';
            shopData.supplies.forEach(item => {
                const canAfford = gameState.coins >= item.price;
                const div = document.createElement('div');
                div.className = `shop-item ${!canAfford ? 'disabled' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">ü™ô ${item.price}</div>
                `;
                if (canAfford) {
                    div.onclick = () => buySupply(item);
                }
                supplyContainer.appendChild(div);
            });
            
            // Cleaners
            const cleanerContainer = document.getElementById('cleanerItems');
            cleanerContainer.innerHTML = '';
            shopData.cleaners.forEach(item => {
                const owned = ownedItems.cleaners.includes(item.id);
                const canAfford = gameState.coins >= item.price;
                const div = document.createElement('div');
                div.className = `shop-item ${owned ? 'owned' : ''} ${!canAfford && !owned ? 'disabled' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    ${owned ? '<div class="item-owned">‚úì Owned</div>' : `<div class="item-price">ü™ô ${item.price}</div>`}
                `;
                if (!owned && canAfford) {
                    div.onclick = () => buyItem('cleaners', item);
                }
                cleanerContainer.appendChild(div);
            });
            
            // Decorations
            const decoContainer = document.getElementById('decorationItems');
            decoContainer.innerHTML = '';
            shopData.decorations.forEach(item => {
                const owned = ownedItems.decorations.includes(item.id);
                const canAfford = gameState.coins >= item.price;
                const div = document.createElement('div');
                div.className = `shop-item ${owned ? 'owned' : ''} ${!canAfford && !owned ? 'disabled' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    ${owned ? '<div class="item-owned">‚úì Owned</div>' : `<div class="item-price">ü™ô ${item.price}</div>`}
                `;
                if (!owned && canAfford) {
                    div.onclick = () => buyItem('decorations', item);
                }
                decoContainer.appendChild(div);
            });
            
            // Upgrades
            const upgradeContainer = document.getElementById('upgradeItems');
            upgradeContainer.innerHTML = '';
            shopData.upgrades.forEach(item => {
                const owned = ownedItems.upgrades.includes(item.id);
                const canAfford = gameState.coins >= item.price;
                const div = document.createElement('div');
                div.className = `shop-item ${owned ? 'owned' : ''} ${!canAfford && !owned ? 'disabled' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    ${owned ? '<div class="item-owned">‚úì Owned</div>' : `<div class="item-price">ü™ô ${item.price}</div>`}
                `;
                if (!owned && canAfford) {
                    div.onclick = () => buyItem('upgrades', item);
                }
                upgradeContainer.appendChild(div);
            });
            
            // Update premium button
            const premiumBtn = document.getElementById('premiumBtn');
            if (gameState.hasBigTank) {
                premiumBtn.textContent = '‚úÖ Big Tank Unlocked!';
                premiumBtn.disabled = true;
                premiumBtn.style.opacity = '0.6';
            }
        }

        function buySupply(item) {
            if (gameState.coins < item.price) return;
            
            gameState.coins -= item.price;
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            
            if (item.type === 'water') {
                gameState.waterBottles += item.amount;
                document.getElementById('waterBottles').textContent = gameState.waterBottles;
            }
            
            renderShop();
        }

        // Decoration slot system
        function selectDecoSlot(slotIndex) {
            if (decoSlots[slotIndex]) return; // Already filled
            
            selectedSlot = slotIndex;
            const availableDecos = ownedItems.decorations.filter(id => !decoSlots.includes(id));
            
            if (availableDecos.length === 0) {
                alert('Buy decorations from the shop first!');
                return;
            }
            
            // Show decoration picker
            const picker = prompt('Choose decoration:\n' + availableDecos.map((id, i) => {
                const item = shopData.decorations.find(d => d.id === id);
                return `${i + 1}. ${item.icon} ${item.name}`;
            }).join('\n') + '\n\nEnter number:');
            
            if (picker && !isNaN(picker)) {
                const idx = parseInt(picker) - 1;
                if (idx >= 0 && idx < availableDecos.length) {
                    placeDecoration(slotIndex, availableDecos[idx]);
                }
            }
        }

        function placeDecoration(slotIndex, decoId) {
            const item = shopData.decorations.find(d => d.id === decoId);
            if (!item) return;
            
            decoSlots[slotIndex] = decoId;
            const slot = document.querySelector(`[data-slot="${slotIndex}"]`);
            slot.innerHTML = item.icon;
            slot.classList.add('filled');
        }

        // Premium big tank purchase
        function purchaseBigTank() {
            if (gameState.hasBigTank) return;
            
            // Simulate payment (in real app, integrate payment gateway)
            const confirmed = confirm('üèÜ PREMIUM UPGRADE\n\nBig Tank - $4.99 USD\n‚Ä¢ Tank size increases significantly\n‚Ä¢ Hold up to 9 fish!\n‚Ä¢ More room for decorations\n\nClick OK to purchase (simulated)');
            
            if (confirmed) {
                gameState.hasBigTank = true;
                gameState.maxFish = 9;
                
                // Resize tank
                tank.classList.add('big-tank');
                updateTankDimensions();
                
                // Update fish count display
                updateFishCount();
                
                // Add more decoration slots
                const slotsContainer = document.getElementById('decoSlots');
                for (let i = 5; i < 8; i++) {
                    const newSlot = document.createElement('div');
                    newSlot.className = 'deco-slot';
                    newSlot.dataset.slot = i;
                    newSlot.onclick = () => selectDecoSlot(i);
                    slotsContainer.appendChild(newSlot);
                    decoSlots.push(null);
                }
                
                // Show success message
                const msg = document.createElement('div');
                msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,#ffd700,#ff8c00);color:#000;padding:30px 50px;border-radius:20px;font-family:"Fredoka One",cursive;font-size:1.8rem;z-index:9999;text-align:center;box-shadow:0 0 60px rgba(255,215,0,0.9);';
                msg.innerHTML = 'üéâ BIG TANK UNLOCKED! üéâ<br><span style="font-size:1rem;">You can now have up to 9 fish!</span>';
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 3000);
                
                renderShop();
            }
        }

        function updateFishCount() {
            document.getElementById('fishCount').textContent = `üêü ${gameState.currentFish}/${gameState.maxFish} Fish`;
        }

        // Customize functions
        function openCustomize() {
            document.getElementById('customizeModal').classList.add('show');
            renderCustomization();
        }

        function closeCustomize() {
            document.getElementById('customizeModal').classList.remove('show');
        }

        function renderCustomization() {
            // Colors
            const colorContainer = document.getElementById('colorOptions');
            colorContainer.innerHTML = '';
            Object.entries(fishColors).forEach(([id, data]) => {
                const owned = ownedCustomizations.colors.includes(id);
                const selected = fishCustomization.color === id;
                const div = document.createElement('div');
                div.className = `color-option ${selected ? 'selected' : ''} ${!owned ? 'locked' : ''}`;
                div.style.background = `linear-gradient(145deg, ${data.c1}, ${data.c2})`;
                div.title = owned ? id : `üîí ${data.price} coins`;
                div.onclick = () => selectColor(id);
                colorContainer.appendChild(div);
            });
            
            // Patterns
            const patternContainer = document.getElementById('patternOptions');
            patternContainer.innerHTML = '';
            fishPatterns.forEach(p => {
                const owned = ownedCustomizations.patterns.includes(p.id);
                const selected = fishCustomization.pattern === p.id;
                const div = document.createElement('div');
                div.className = `pattern-option ${selected ? 'selected' : ''} ${!owned ? 'locked' : ''}`;
                div.textContent = owned ? p.name : `üîí ${p.name} (${p.price})`;
                div.onclick = () => selectPattern(p.id);
                patternContainer.appendChild(div);
            });
            
            // Accessories
            const accessoryContainer = document.getElementById('accessoryOptions');
            accessoryContainer.innerHTML = '';
            fishAccessories.forEach(a => {
                const owned = ownedCustomizations.accessories.includes(a.id);
                const selected = fishCustomization.accessory === a.id;
                const div = document.createElement('div');
                div.className = `accessory-option ${selected ? 'selected' : ''} ${!owned ? 'locked' : ''}`;
                div.textContent = owned ? a.name : `üîí ${a.name} (${a.price})`;
                div.onclick = () => selectAccessory(a.id);
                accessoryContainer.appendChild(div);
            });
            
            updatePreview();
        }

        function selectColor(colorId) {
            const data = fishColors[colorId];
            if (!ownedCustomizations.colors.includes(colorId)) {
                if (gameState.coins >= data.price) {
                    if (confirm(`Buy ${colorId} color for ${data.price} coins?`)) {
                        gameState.coins -= data.price;
                        ownedCustomizations.colors.push(colorId);
                        document.getElementById('coins').textContent = gameState.coins.toLocaleString();
                    } else return;
                } else {
                    alert('Not enough coins!');
                    return;
                }
            }
            fishCustomization.color = colorId;
            renderCustomization();
        }

        function selectPattern(patternId) {
            const data = fishPatterns.find(p => p.id === patternId);
            if (!ownedCustomizations.patterns.includes(patternId)) {
                if (gameState.coins >= data.price) {
                    if (confirm(`Buy ${data.name} pattern for ${data.price} coins?`)) {
                        gameState.coins -= data.price;
                        ownedCustomizations.patterns.push(patternId);
                        document.getElementById('coins').textContent = gameState.coins.toLocaleString();
                    } else return;
                } else {
                    alert('Not enough coins!');
                    return;
                }
            }
            fishCustomization.pattern = patternId;
            renderCustomization();
        }

        function selectAccessory(accessoryId) {
            const data = fishAccessories.find(a => a.id === accessoryId);
            if (!ownedCustomizations.accessories.includes(accessoryId)) {
                if (gameState.coins >= data.price) {
                    if (confirm(`Buy ${data.name} for ${data.price} coins?`)) {
                        gameState.coins -= data.price;
                        ownedCustomizations.accessories.push(accessoryId);
                        document.getElementById('coins').textContent = gameState.coins.toLocaleString();
                    } else return;
                } else {
                    alert('Not enough coins!');
                    return;
                }
            }
            fishCustomization.accessory = accessoryId;
            renderCustomization();
        }

        function updatePreview() {
            const colors = fishColors[fishCustomization.color];
            document.getElementById('previewColor1').style.stopColor = colors.c1;
            document.getElementById('previewColor2').style.stopColor = colors.c2;
            document.getElementById('previewColor3').style.stopColor = colors.c3;
            
            const acc = fishAccessories.find(a => a.id === fishCustomization.accessory);
            document.getElementById('previewAccessory').textContent = acc ? acc.icon : '';
        }

        function applyCustomization() {
            const colors = fishColors[fishCustomization.color];
            
            // Update main fish SVG gradients
            const fishGradStops = fishEl.querySelectorAll('#fishGrad stop, #finGrad stop');
            const stops = fishEl.querySelectorAll('#fishGrad stop');
            if (stops[0]) stops[0].style.stopColor = colors.c1;
            if (stops[1]) stops[1].style.stopColor = colors.c2;
            if (stops[2]) stops[2].style.stopColor = colors.c2;
            if (stops[3]) stops[3].style.stopColor = colors.c3;
            
            // Add accessory to fish
            let existingAcc = fishEl.querySelector('.fish-accessory');
            if (existingAcc) existingAcc.remove();
            
            const acc = fishAccessories.find(a => a.id === fishCustomization.accessory);
            if (acc && acc.icon) {
                const accEl = document.createElement('div');
                accEl.className = 'fish-accessory';
                accEl.style.cssText = 'position:absolute;top:-15px;left:50%;transform:translateX(-50%);font-size:20px;z-index:11;';
                accEl.textContent = acc.icon;
                fishEl.parentElement.insertBefore(accEl, fishEl);
            }
            
            closeCustomize();
        }

        function buyItem(category, item) {
            if (gameState.coins < item.price) return;
            if (ownedItems[category].includes(item.id)) return;
            
            gameState.coins -= item.price;
            ownedItems[category].push(item.id);
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            
            // Create cleaner animal in tank
            if (category === 'cleaners') {
                spawnCleaner(item);
            }
            
            // Add decoration to tank
            if (category === 'decorations') {
                addDecoration(item);
            }
            
            renderShop();
        }

        function spawnCleaner(item) {
            const cleaner = document.createElement('div');
            cleaner.className = item.id;
            cleaner.style.position = 'absolute';
            cleaner.style.bottom = '55px';
            cleaner.style.left = (100 + Math.random() * (tankWidth - 200)) + 'px';
            cleaner.style.fontSize = '28px';
            cleaner.style.zIndex = '8';
            cleaner.innerHTML = item.icon;
            tank.appendChild(cleaner);
            
            cleanerAnimals.push({
                type: item.id,
                element: cleaner,
                x: parseFloat(cleaner.style.left),
                dx: (Math.random() > 0.5 ? 1 : -1) * (0.3 + Math.random() * 0.4)
            });
        }

        function spawnNewFish() {
            if (gameState.currentFish >= gameState.maxFish) return;
            
            const fishColors = ['#ff9966', '#66b3ff', '#ff66b2', '#66ff99', '#ffcc66', '#cc99ff', '#ff6666', '#66ffcc'];
            const randomColor = fishColors[Math.floor(Math.random() * fishColors.length)];
            
            const newFish = document.createElement('div');
            newFish.className = 'extra-fish';
            newFish.innerHTML = `
                <svg viewBox="0 0 75 55" style="width:100%;height:100%;">
                    <defs>
                        <linearGradient id="fishGrad${extraFish.length}" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:${randomColor}"/>
                            <stop offset="100%" style="stop-color:${adjustColor(randomColor, -40)}"/>
                        </linearGradient>
                    </defs>
                    <path d="M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27" fill="url(#fishGrad${extraFish.length})">
                        <animate attributeName="d" dur="0.25s" repeatCount="indefinite"
                            values="M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27;
                                    M5 27 Q0 18 10 13 Q14 24 14 27 Q14 30 10 41 Q0 36 5 27;
                                    M5 27 Q-2 15 10 8 Q14 22 14 27 Q14 32 10 46 Q-2 39 5 27"/>
                    </path>
                    <ellipse cx="38" cy="27" rx="28" ry="20" fill="url(#fishGrad${extraFish.length})"/>
                    <path d="M32 8 Q38 -2 50 4 Q45 12 38 10 Z" fill="url(#fishGrad${extraFish.length})"/>
                    <ellipse cx="54" cy="22" rx="8" ry="9" fill="white"/>
                    <circle cx="56" cy="22" r="5" fill="#1a1a2e"/>
                    <circle cx="57" cy="20" r="2" fill="white"/>
                    <ellipse cx="64" cy="30" rx="4" ry="2.5" fill="#cc3300" opacity="0.85"/>
                </svg>
            `;
            
            const startX = 50 + Math.random() * (tankWidth - 150);
            const startY = 50 + Math.random() * (tankHeight - 200);
            newFish.style.left = startX + 'px';
            newFish.style.top = startY + 'px';
            tank.appendChild(newFish);
            
            extraFish.push({
                element: newFish,
                x: startX,
                y: startY,
                targetX: startX,
                targetY: startY,
                speed: 1.5 + Math.random() * 1.5,
                facingRight: Math.random() > 0.5
            });
            
            gameState.currentFish++;
            updateFishCount();
        }

        function adjustColor(hex, amount) {
            // Simple color adjustment
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        function moveExtraFish() {
            const sandHeight = tankHeight * 0.115;
            const waterTop = tankHeight * (1 - gameState.waterLevel / 100) + 20;
            const maxY = tankHeight - sandHeight - 50;
            
            extraFish.forEach(f => {
                // Move toward target
                const dx = f.targetX - f.x;
                const dy = f.targetY - f.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 5) {
                    f.x += (dx / dist) * f.speed;
                    f.y += (dy / dist) * f.speed;
                    
                    // Flip direction
                    if (dx > 0 && !f.facingRight) {
                        f.facingRight = true;
                        f.element.classList.remove('flip');
                    } else if (dx < 0 && f.facingRight) {
                        f.facingRight = false;
                        f.element.classList.add('flip');
                    }
                } else {
                    // Pick new target
                    f.targetX = 30 + Math.random() * (tankWidth - 100);
                    f.targetY = Math.max(waterTop, 30) + Math.random() * (maxY - waterTop);
                }
                
                f.element.style.left = f.x + 'px';
                f.element.style.top = f.y + 'px';
            });
        }

        function buyFish() {
            if (!gameState.hasBigTank) {
                alert('You need the Big Tank expansion to buy more fish!');
                return;
            }
            
            const fishPrice = 100;
            if (gameState.coins < fishPrice) {
                alert('Not enough coins! Fish cost 100 coins.');
                return;
            }
            
            if (gameState.currentFish >= gameState.maxFish) {
                alert('Your tank is full! Max ' + gameState.maxFish + ' fish.');
                return;
            }
            
            gameState.coins -= fishPrice;
            document.getElementById('coins').textContent = gameState.coins.toLocaleString();
            spawnNewFish();
            renderShop();
        }

        function addDecoration(item) {
            // Find first empty slot and place decoration there
            const emptySlotIndex = decoSlots.findIndex(s => s === null);
            if (emptySlotIndex !== -1) {
                placeDecoration(emptySlotIndex, item.id);
            }
        }

        // Game over
        function gameOver() {
            gameState.isAlive = false;
            fishEl.classList.add('dead');
            fishEl.classList.remove('escaped', 'overfed');
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCoins').textContent = gameState.coins.toLocaleString();
            document.getElementById('deathReason').textContent = gameState.deathReason;
            document.getElementById('gameOver').classList.add('show');
        }

        // Restart game
        function restartGame() {
            // Keep coins, owned items, and big tank status
            const savedCoins = gameState.coins;
            const savedOwned = JSON.parse(JSON.stringify(ownedItems));
            const savedBigTank = gameState.hasBigTank;
            const savedMaxFish = gameState.maxFish;
            const savedWaterBottles = gameState.waterBottles;
            
            gameState = {
                hunger: 70,
                happiness: 100,
                health: 100,
                cleanliness: 100,
                waterLevel: 100,
                score: 0,
                coins: savedCoins,
                isAlive: true,
                isEscaped: false,
                foodCount: 0,
                uneatenFood: 0,
                overfedLevel: 0,
                deathReason: '',
                lastCoinTime: 0,
                waterBottles: savedWaterBottles,
                hasBigTank: savedBigTank,
                maxFish: savedMaxFish,
                currentFish: 1
            };
            
            ownedItems = savedOwned;
            
            fish = {
                x: tankWidth * 0.4,
                y: tankHeight * 0.4,
                targetX: tankWidth * 0.4,
                targetY: tankHeight * 0.4,
                speed: 2.5,
                facingRight: true,
                goingToFood: false
            };
            
            // Clear food
            foodItems.forEach(f => f.element.remove());
            foodItems = [];
            
            // Clear extra fish
            extraFish.forEach(f => f.element.remove());
            extraFish = [];
            
            // Reset fish storm for new game
            fishStormActive = false;
            
            // Reset visuals
            fishEl.classList.remove('dead', 'flip', 'escaped', 'overfed');
            document.getElementById('gameOver').classList.remove('show');
            document.getElementById('score').textContent = '0';
            document.getElementById('coins').textContent = savedCoins.toLocaleString();
            document.getElementById('waterBottles').textContent = savedWaterBottles;
            warningIcon.classList.remove('show');
            
            updateFishPosition();
            updateFishCount();
            updateVisuals();
        }

        // Start game
        init();
    </script>
</body>
</html>
